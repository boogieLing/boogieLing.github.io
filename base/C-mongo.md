# MongoDB

MongoDB是一个文档数据库，提供好的性能，领先的非关系型数据库。采用BSON存储文档数据。

集合就算一组mongo文档，类似关系型数据库里面表的概念

默认端口27017

**规则：** 如果业务中存在大量复杂的事务逻辑操作，则不要用`MongoDB`数据库；

1在处理非结构化 / 半结构化的大数据使用`MongoDB`，操作的数据类型为动态时也使用`MongoDB`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

## 优势

1. 天生持久化
2. 面向文档存储，以json格式保存
3. 文档中的任何属性都可以建立索引
4. 快速的即时更新
5. 使用简单
6. 不需要转化对象，拿到就可以直接使用
7. 利用mmap系统构建存储，快

## 数据类型

1. String：只有utf-8字符串才是合法的
2. 整型
3. double
4. Boolean
5. Arr
6. Datetime
7. **ObjectId**：天生基于分布式主键的时间，带有时间信息
8. Code
9. Regular Expression：可以存储正则表达式
10. Object：用于内嵌文档

## 索引类型

1. 单字段索引
2. 复合索引
3. 多键索引
4. 全文索引
5. hash索引
6. 通配符索引
7. 2dsphere索引

## mysql和mongo

1. mysql关系型，mongo非关系型，面向文档
2. 数据处理方式
    1. mysql要看引擎
    2. mongo基于内存，把热数据放到物理内存高速读写

## redis和mongo

1. 内存管理
    1. redis全部数据放在内存，定期写入磁盘，但是失配不找磁盘
    2. mongo数据在内存，由mmap系统实现，当内存不够就把热点保留在内存，其他写入磁盘，**失配会去找磁盘**
2. 事务
    1. redis有没什么用的事务，单纯串行而且不会回滚
    2. mongo只有单文档事务，复杂事务没有，比redis还差

## 如何执行事务、加锁

mongo没有传统的锁或者复杂的带回滚的事务，这个应该要在客户端实现

## 更新会马上fsync到磁盘？

不会，磁盘写操作默认是延迟执行的，可能在两三秒之后才到达。

**通过`syncPeriodSecs` 启动参数，可以进行配置**

